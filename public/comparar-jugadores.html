<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparar Jugadores - Sistema de EstadÃ­sticas DominÃ³</title>
    <link rel="stylesheet" href="css/comparar-jugadores.css">
    <script src="js/api-config.js"></script>

    <style>
        .btn-inicio-flotante-js {
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
            background: linear-gradient(135deg, #16a34a 0%, #114d37 100%) !important;
            color: white !important;
            padding: 15px 28px !important;
            border-radius: 50px !important;
            text-decoration: none !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 12px !important;
            font-family: 'Segoe UI', Arial, sans-serif !important;
            font-size: 15px !important;
            font-weight: 700 !important;
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.6) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            z-index: 999999 !important;
            border: 3px solid #f97316 !important;
            cursor: pointer !important;
            outline: none !important;
            visibility: visible !important;
            opacity: 1 !important;
            white-space: nowrap !important;
        }

        .btn-inicio-flotante-js svg {
            width: 24px !important;
            height: 24px !important;
            flex-shrink: 0 !important;
            stroke: white !important;
        }

        .btn-inicio-flotante-js:hover {
            transform: translateY(-4px) scale(1.05) !important;
            box-shadow: 0 12px 35px rgba(22, 163, 74, 0.8) !important;
            background: linear-gradient(135deg, #15803d 0%, #0d3d2b 100%) !important;
        }

        .btn-inicio-flotante-js:active {
            transform: translateY(-2px) scale(0.98) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ² Comparar jugadores</h1>
        </div>

        <div class="comparar-section">
            <h2>Comparar Jugadores</h2>

            <div class="comparar-form">
                <div class="input-group">
                    <label for="jugador1">Jugador 1</label>
                    <input type="text" id="jugador1" placeholder="Ingresa carnet del jugador 1" class="comparar-input">
                </div>

                <div class="input-group">
                    <label for="jugador2">Jugador 2</label>
                    <input type="text" id="jugador2" placeholder="Ingresa carnet del jugador 2" class="comparar-input">
                </div>

                <button id="btn-comparar" class="btn-comparar" onclick="compararJugadores()">Comparar</button>
            </div>

            <div id="mensaje-error" class="mensaje-error" style="display: none;"></div>

            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Cargando datos...</p>
            </div>

            <div id="resultados" class="comparar-resultados" style="display: none;">
                <!-- Jugador 1 -->
                <div class="jugador-card">
                    <div class="jugador-header">
                        <div class="jugador-avatar">ðŸ‘¤</div>
                        <div class="jugador-info">
                            <h3 id="nombre-j1">Jugador 1</h3>
                            <div class="jugador-pais">
                                <img id="bandera-j1" src="" alt="" class="bandera-icon">
                                <span id="pais-j1">PaÃ­s</span>
                            </div>
                        </div>
                    </div>
                    <div class="jugador-stats">
                        <div class="stat-item">
                            <span class="stat-label">Partidas:</span>
                            <span class="stat-value" id="partidas-j1">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Victorias:</span>
                            <span class="stat-value" id="victorias-j1">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Derrotas:</span>
                            <span class="stat-value" id="derrotas-j1">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">% Victorias:</span>
                            <span class="stat-value" id="pct-victorias-j1">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pts Obtenidos:</span>
                            <span class="stat-value" id="pts-obtenidos-j1">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pts Permitidos:</span>
                            <span class="stat-value" id="pts-permitidos-j1">0</span>
                        </div>
                        <div class="stat-item efectividad">
                            <span class="stat-label">Efectividad:</span>
                            <span class="stat-value" id="efectividad-j1">0</span>
                        </div>
                    </div>
                </div>

                <!-- Jugador 2 -->
                <div class="jugador-card">
                    <div class="jugador-header">
                        <div class="jugador-avatar">ðŸ‘¤</div>
                        <div class="jugador-info">
                            <h3 id="nombre-j2">Jugador 2</h3>
                            <div class="jugador-pais">
                                <img id="bandera-j2" src="" alt="" class="bandera-icon">
                                <span id="pais-j2">PaÃ­s</span>
                            </div>
                        </div>
                    </div>
                    <div class="jugador-stats">
                        <div class="stat-item">
                            <span class="stat-label">Partidas:</span>
                            <span class="stat-value" id="partidas-j2">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Victorias:</span>
                            <span class="stat-value" id="victorias-j2">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Derrotas:</span>
                            <span class="stat-value" id="derrotas-j2">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">% Victorias:</span>
                            <span class="stat-value" id="pct-victorias-j2">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pts Obtenidos:</span>
                            <span class="stat-value" id="pts-obtenidos-j2">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pts Permitidos:</span>
                            <span class="stat-value" id="pts-permitidos-j2">0</span>
                        </div>
                        <div class="stat-item efectividad">
                            <span class="stat-label">Efectividad:</span>
                            <span class="stat-value" id="efectividad-j2">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-bottom">
            <p>&copy; 2025 Sistema de EstadÃ­sticas DominÃ³. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- BotÃ³n flotante de inicio -->
    <a href="index.html" class="btn-inicio-flotante-js" title="Volver al inicio">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>Inicio</span>
    </a>

    <script>
        async function compararJugadores() {
            const carnet1 = document.getElementById('jugador1').value.trim();
            const carnet2 = document.getElementById('jugador2').value.trim();
            
            document.getElementById('mensaje-error').style.display = 'none';
            
            if (!carnet1 || !carnet2) {
                mostrarError('Por favor ingresa ambos carnets');
                return;
            }
            
            if (carnet1 === carnet2) {
                mostrarError('No puedes comparar un jugador consigo mismo');
                return;
            }
            
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('resultados').style.display = 'none';
            
            try {
                const [result1, result2] = await Promise.all([
                    API.get(`/comparar/${carnet1}`).catch(e => ({ success: false })),
                    API.get(`/comparar/${carnet2}`).catch(e => ({ success: false }))
                ]);
                
                let jugador1Data = null;
                let jugador2Data = null;
                let errores = [];
                
                if (result1.success && result1.data && result1.data.length > 0) {
                    jugador1Data = result1.data[0];
                } else {
                    errores.push('Jugador 1');
                }
                
                if (result2.success && result2.data && result2.data.length > 0) {
                    jugador2Data = result2.data[0];
                } else {
                    errores.push('Jugador 2');
                }
                
                document.getElementById('loading').style.display = 'none';
                
                if (errores.length > 0) {
                    const mensaje = errores.length === 2 
                        ? 'Ninguno de los jugadores existe'
                        : `El ${errores[0]} no existe`;
                    mostrarError(mensaje);
                    return;
                }
                
                mostrarDatos(jugador1Data, jugador2Data);
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                mostrarError('Error al conectar con el servidor');
            }
        }
        
        function mostrarDatos(j1, j2) {
            document.getElementById('nombre-j1').textContent = j1.Jugador;
            document.getElementById('pais-j1').textContent = j1.Pais;
            document.getElementById('bandera-j1').src = `https://flagcdn.com/24x18/${j1.Bandera}.png`;
            document.getElementById('partidas-j1').textContent = j1.Partidas;
            document.getElementById('victorias-j1').textContent = j1.Victorias;
            document.getElementById('derrotas-j1').textContent = j1.Derrotas;
            document.getElementById('pct-victorias-j1').textContent = (j1.Partidas > 0 ? ((j1.Victorias / j1.Partidas) * 100).toFixed(2) : 0) + '%';
            document.getElementById('pts-obtenidos-j1').textContent = j1.PuntosOb;
            document.getElementById('pts-permitidos-j1').textContent = j1.PuntosPer;
            document.getElementById('efectividad-j1').textContent = j1.Efectividad;
            
            document.getElementById('nombre-j2').textContent = j2.Jugador;
            document.getElementById('pais-j2').textContent = j2.Pais;
            document.getElementById('bandera-j2').src = `https://flagcdn.com/24x18/${j2.Bandera}.png`;
            document.getElementById('partidas-j2').textContent = j2.Partidas;
            document.getElementById('victorias-j2').textContent = j2.Victorias;
            document.getElementById('derrotas-j2').textContent = j2.Derrotas;
            document.getElementById('pct-victorias-j2').textContent = (j2.Partidas > 0 ? ((j2.Victorias / j2.Partidas) * 100).toFixed(2) : 0) + '%';
            document.getElementById('pts-obtenidos-j2').textContent = j2.PuntosOb;
            document.getElementById('pts-permitidos-j2').textContent = j2.PuntosPer;
            document.getElementById('efectividad-j2').textContent = j2.Efectividad;
            
            document.querySelectorAll('.stat-value').forEach(el => el.classList.remove('mejor-stat'));
            
            if (j1.Partidas > j2.Partidas) document.getElementById('partidas-j1').classList.add('mejor-stat');
            else if (j2.Partidas > j1.Partidas) document.getElementById('partidas-j2').classList.add('mejor-stat');
            
            if (j1.Victorias > j2.Victorias) document.getElementById('victorias-j1').classList.add('mejor-stat');
            else if (j2.Victorias > j1.Victorias) document.getElementById('victorias-j2').classList.add('mejor-stat');
            
            if (j1.PuntosOb > j2.PuntosOb) document.getElementById('pts-obtenidos-j1').classList.add('mejor-stat');
            else if (j2.PuntosOb > j1.PuntosOb) document.getElementById('pts-obtenidos-j2').classList.add('mejor-stat');
            
            if (j1.Efectividad > j2.Efectividad) document.getElementById('efectividad-j1').classList.add('mejor-stat');
            else if (j2.Efectividad > j1.Efectividad) document.getElementById('efectividad-j2').classList.add('mejor-stat');
            
            const pct1 = j1.Partidas > 0 ? ((j1.Victorias / j1.Partidas) * 100) : 0;
            const pct2 = j2.Partidas > 0 ? ((j2.Victorias / j2.Partidas) * 100) : 0;
            if (pct1 > pct2) document.getElementById('pct-victorias-j1').classList.add('mejor-stat');
            else if (pct2 > pct1) document.getElementById('pct-victorias-j2').classList.add('mejor-stat');
            
            if (j1.Derrotas < j2.Derrotas && j1.Derrotas > 0) document.getElementById('derrotas-j1').classList.add('mejor-stat');
            else if (j2.Derrotas < j1.Derrotas && j2.Derrotas > 0) document.getElementById('derrotas-j2').classList.add('mejor-stat');
            
            if (j1.PuntosPer < j2.PuntosPer && j1.PuntosPer > 0) document.getElementById('pts-permitidos-j1').classList.add('mejor-stat');
            else if (j2.PuntosPer < j1.PuntosPer && j2.PuntosPer > 0) document.getElementById('pts-permitidos-j2').classList.add('mejor-stat');
            
            document.getElementById('resultados').style.display = 'grid';
        }
        
        function mostrarError(mensaje) {
            const errorDiv = document.getElementById('mensaje-error');
            errorDiv.textContent = mensaje;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }
        
        document.getElementById('jugador1').addEventListener('keypress', e => {
            if (e.key === 'Enter') compararJugadores();
        });
        
        document.getElementById('jugador2').addEventListener('keypress', e => {
            if (e.key === 'Enter') compararJugadores();
        });
    </script>
</body>
</html>